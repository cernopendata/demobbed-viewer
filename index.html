<!doctype html>
<html lang="en">

  <head>

    <title>OPERA demobbed-viewer</title>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/demobbed.css">

    <script src="js/lib/jquery.min.js"></script>
    <script src="js/lib/bootstrap.min.js"></script>
    <script src="js/lib/d3.min.js"></script>
    <script src="js/lib/three.min.js"></script>
    <script src="js/lib/three3DExtras.min.js"></script>
    <script src="js/lib/TrackballControls.js"></script>

    <script src="js/DetCfg-def.js"></script>
    <script src="js/Utils-def.js"></script>
    <script src="js/Hits-defs.js"></script>
    <script src="js/Vertex-def.js"></script>
    <script src="js/TrackECC-def.js"></script>
    <script src="js/Event-def.js"></script>
    <script src="js/loadUserSpecifiedEvent.js"></script>
    <script src="js/changeEventSample.js"></script>
    <script src="js/DetElems-defs.js"></script>
    <script src="js/MgrGeomED-def.js"></script>
    <script src="js/MgrDrawED-def.js"></script>
    <script src="js/MgrDrawECC-def.js"></script>
    <script src="js/Demobbed-def.js"></script>
    <script src="js/init.js"></script>
    <script src="js/Demobbed-fills.js"></script>
    <script src="js/MgrGeomED-fills.js"></script>
    <script src="js/MgrGeomED-funcAdd.js"></script>
    <script src="js/MgrDrawED-funcAdd.js"></script>
    <script src="js/MgrDrawECC-funcAdd.js"></script>

  </head>

  <body id="body-demobbed-viewer" data-event-id="9190097972">

    <div class="viewer" id="div-viewer">

      <div class="sidebar" id="div-sidebar">

        <div id="div-logo-img">
          <a target="_blank" href="http://operaweb.lngs.infn.it/">
            <img src="graphics/opera.png" alt="OPERA" title="OPERA experiment">
          </a>
        </div>

        <div id="div-nu-beam-img"> <img src="graphics/nu-beam.png"> </div>

        <div class="col" id="div-controls-ED">
          <table>

            <tr>
              <td>
                <div class="btn-group" role="group">
                  <button type="button" id="btn-ed-move-view-xz-up" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(0, 1);" title="Move ED XZ view up">
                    <img src="graphics/view-up.png" class="img-responsive"/>
                  </button>
                  <button type="button" id="btn-ed-move-view-xz-down" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(0, -1);" title="Move ED XZ view down">
                    <img src="graphics/view-down.png" class="img-responsive"/>
                  </button>
                </div>
              </td>
            </tr>

            <tr>
              <td>
                <div class="btn-group" role="group">
                  <button type="button" id="btn-ed-move-views-left" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(2, -1);" title="Move ED views left">
                    <img src="graphics/view-left.png" class="img-responsive"/>
                  </button>
                  <button type="button" id="btn-ed-move-views-right" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(2,  1);" title="Move ED views right">
                    <img src="graphics/view-right.png" class="img-responsive"/>
                  </button>
                </div>
              </td>
            </tr>

            <tr>
              <td>
                <div class="btn-group" role="group">
                  <button type="button" id="btn-ed-move-view-yz-up" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(1, 1);" title="Move ED YZ view up">
                    <img src="graphics/view-up.png" class="img-responsive"/>
                  </button>
                  <button type="button" id="btn-ed-move-view-yz-down" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawED().moveView(1, -1);" title="Move ED YZ view down">
                    <img src="graphics/view-down.png" class="img-responsive"/>
                  </button>
                </div>
              </td>
            </tr>

          </table>
        </div> <!-- div-controls-ED" -->

      </div> <!-- "div-sidebar" -->

      <div class="container-fluid" id="div-display">

        <div class="row" id="div-row-display-ED">
          <div class="col-md-12" id="div-col-display-ED">

            <div class="titlebar" id="div-titlebar-ED">OPERA electronic detectors (ED) display</div>

            <div id="div-toolbar-ED">

              <select id="select-eventSample-ED" onchange="changeEventSample(this, event, value);">
                <optgroup label="&nbsp;Sample:">
                  <option value="nuMu">nuMu</option>
                  <option value="nuTau">nuTau</option>
                  <option value="nuE">nuE</option>
                  <option value="charm">charm</option>
                </optgroup>
              </select>

              <label for="input-event-ED">Event:</label>
              <input id="input-event-ED" onkeypress="loadUserSpecifiedEvent(this, event, value);" size="11">

              <!-- ----------------------------------------- -->

              <div class="btn-group" role="group">
                <button type="button" id="btn-ed-prev-event" class="btn btn-default btn-xs"
                        onclick="demobbed.loadPrevOrNextEvent(-1);" title="Previous event">
                  <img src="graphics/event-prev.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ed-reload-event" class="btn btn-default btn-xs"
                        onclick="demobbed.loadPrevOrNextEvent(0);" title="Reload the event">
                  <img src="graphics/event-reload.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ed-next-event" class="btn btn-default btn-xs"
                        onclick="demobbed.loadPrevOrNextEvent(1);" title="Next event">
                  <img src="graphics/event-next.png"
                       class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ed-zoom-in" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawED().zoomIn();" title="Zoom in">
                  <img src="graphics/zoom-in.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ed-zoom-out" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawED().zoomOut();" title="Zoom out">
                  <img src="graphics/zoom-out.png"
                       class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ed-zoom-brick" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawED().zoomToBrick();" title="Show the vertex brick">
                  <img src="graphics/zoom-brick.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ed-zoom-event" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawED().zoomToEvent();" title="Show the event region">
                  <img src="graphics/zoom-event.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ed-zoom-det" class="btn btn-default btn-xs active"
                        onclick="demobbed.mgrDrawED().zoomToDetector();" title="Show the whole detector">
                  <img src="graphics/zoom-det.png"
                       class="img-responsive"/>
                </button>
              </div>

              <!--
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().drawECC(1);" title="Open the ECC display">
                  <img src="graphics/open-ECC.png"
                       class="img-responsive"/>
                </button>
              </div>
              -->

              <div class="btn-group" role="group">
                <button type="button" id="btn-help" class="btn btn-default btn-xs" data-toggle="modal"
                        data-target="#div-help" title="Help">
                  <img src="graphics/help.png" class="img-responsive"/>
                </button>
                <button type="button" id="btn-about" class="btn btn-default btn-xs" data-toggle="modal"
                        data-target="#div-about" title="About">
                  <img src="graphics/about.png"
                       class="img-responsive"/>
                </button>
              </div>

            </div> <!-- "div-toolbar-ED" -->

            <div class="row ed-display">
              <div id="div-canvas-ED-XZ">
                <span id="span-canvas-ED-XZ-title" class="canvas-title"></span>
              </div>
              <div id="div-canvas-ED-YZ">
                <span id="span-canvas-ED-YZ-title" class="canvas-title"></span>
              </div>
            </div>

          </div> <!-- "div-col-display-ED" -->
        </div> <!-- div-row-display-ED" -->

        <div class="row" id="div-row-display-ECC">
          <div class="col-md-12" id="div-col-display-ECC">

            <div class="titlebar" id="div-titlebar-ECC">OPERA lead-emulsion detectors (ECC) display</div>

            <div id="div-toolbar-ECC">
              <select id="select-eventSample-ECC" onchange="changeEventSample(this, event, value);">
                <optgroup label="&nbsp;Sample:">
                  <option value="nuMu">nuMu</option>
                  <option value="nuTau">nuTau</option>
                  <option value="nuE">nuE</option>
                  <option value="charm">charm</option>
                </optgroup>
              </select>

              <label for="input-event-ECC">Event:</label>
              <input id="input-event-ECC" onkeypress="loadUserSpecifiedEvent(this, event, value);" size="11">

              <div class="btn-group" role="group">
                <button type="button" id="btn-ecc-prev-event" class="btn btn-default btn-xs" onclick="demobbed.loadPrevOrNextEvent(-1);"
                        title="Previous event">
                  <img src="graphics/event-prev.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-reload-event" class="btn btn-default btn-xs" onclick="demobbed.loadPrevOrNextEvent(0);"
                        title="Reload the event">
                  <img src="graphics/event-reload.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-next-event" class="btn btn-default btn-xs" onclick="demobbed.loadPrevOrNextEvent(1);"
                        title="Next event">
                  <img src="graphics/event-next.png"
                       class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ecc-def-view-xz" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawECC().setDefaultView(0);" title="Set default XZ view">
                  <img src="graphics/view-xz.png" class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-def-view-yz" class="btn btn-default btn-xs active" onclick="demobbed.mgrDrawECC().setDefaultView(1);" title="Set default YZ view">
                  <img src="graphics/view-yz.png" class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-def-view-xy" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawECC().setDefaultView(2);" title="Set default XY view">
                  <img src="graphics/view-xy.png" class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ecc-zoom-in" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().zoomInOut(1);" title="Zoom in">
                  <img src="graphics/zoom-in.png" class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-zoom-out" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().zoomInOut(-1);" title="Zoom out">
                  <img src="graphics/zoom-out.png" class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ecc-stretch-y" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().stretchY(1);" title="Stretch the view along the Y axis">
                  <img src="graphics/stretch-y.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-compress-y" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().stretchY(-1);" title="Compress the view along the Y axis">
                  <img src="graphics/compress-y.png"
                       class="img-responsive"/>
                </button>
              </div>

              <div class="btn-group" role="group">
                <button type="button" id="btn-ecc-decel-anim" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().decelerateRotation();"
                        title="Decelerate/stop rotation around the Y axis">
                  <img src="graphics/anim-decel.png"
                       class="img-responsive"/>
                </button>
                <button type="button" id="btn-ecc-accel-anim" class="btn btn-default btn-xs"
                        onclick="demobbed.mgrDrawECC().accelerateRotation();"
                        title="Start/accelerate rotation around the Y axis">
                  <img src="graphics/anim-accel.png"
                       class="img-responsive"/>
                </button>
              </div>

              <!--
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-default btn-xs" onclick="demobbed.mgrDrawECC().drawECC(0);"
                        title="Close the ECC display">
                  <img src="graphics/close-ECC.png"
                       class="img-responsive"/>
                </button>
              </div>
              -->

            </div>  <!-- "div-toolbar-ECC" -->

            <div class="row ecc-display">
              <div id="div-canvas-ECC" style="position: relative;">
                <span id="span-canvas-ECC-title" class="canvas-title"></span>
                <canvas id="canvas-axes-ECC" style="position:absolute; left: 0;"></canvas>
                <canvas id="canvas-ECC" class="canvas-bordered-white"></canvas>
              </div> <!-- "div-canvas-ECC" -->
              <div>
                <canvas id="canvas-legend-ECC" class="canvas-bordered-white" width="230" height="230"
                        style="position: relative; left:auto; bottom: 0;"></canvas>
              </div>
            </div>

          </div> <!-- "div-col-display-ECC" -->
        </div> <!-- "div-row-display-ECC" -->

      </div> <!-- "div-display" -->

    </div> <!-- "div-viewer" -->

    <div id="div-ScrLoadEvent">
      <script id="script-LoadEvent" src="js/loadFirstEvent.js"> </script>
    </div>

  </body>

  <!-- ----------------------------------------- -->

  <div id="div-help" role="dialog" class="modal">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times"></i><span class="sr-only">Close</span></button>
          <h4 class="modal-title"><b>Demobbed-viewer help</b></h4>
        </div>

        <div class="modal-body" id="div-help-body">
          <p>
            Demobbed-viewer is a JavaScript application developed for the <a target="_blank" href="http://opendata.cern.ch/">CERN Open Data Portal</a>. The application is supposed to visualise neutrino interaction events registered in the <a target="_blank" href="http://operaweb.lngs.infn.it/">OPERA experiment</a>.
          </p>

          <p>
            At present OPERA open data sample includes four sub-samples (a sub-sample to display can be specified in the left part of the toolbar):
          </p>

          <p>
            &nbsp;&nbsp;&nbsp;&nbsp; - the "nuTau" data sub-sample includes 10 tau neutrino candidate events <a target="_blank" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.120.211801">observed</a> by OPERA in the <a target="_blank" href="http://proj-cngs.web.cern.ch/proj-cngs/">CNGS</a> neutrino beam. 
          </p>

          <p>
            &nbsp;&nbsp;&nbsp;&nbsp; - the "nuMu" data sub-sample includes 817 events used in the <a target="_blank" href="https://link.springer.com/article/10.1140%2Fepjc%2Fs10052-017-5509-y">study</a> of charged hadron multiplicities in charged-current neutrino-lead interactions in the OPERA detector.
          </p>

          <p>
            &nbsp;&nbsp;&nbsp;&nbsp; - the "nuE" data sub-sample includes 19 electron neutrino candidate events <a target="_blank" href="https://link.springer.com/article/10.1007%2FJHEP06%282018%29151">registered</a> in the OPERA detector.
          </p>

          <p>
            &nbsp;&nbsp;&nbsp;&nbsp; - the "charm" data sub-sample includes 50 charm decay candidate events <a target="_blank" href="https://link.springer.com/article/10.1140%2Fepjc%2Fs10052-014-2986-0">registered</a> in the OPERA detector.
          </p>
          
          <p>
            Opera hybrid experimental setup (described in detail <a target="_blank" href="http://iopscience.iop.org/article/10.1088/1748-0221/4/04/P04018/meta/">here</a>) included Electronic detectors (ED) for real-time detection of neutrino interactions and nuclear emulsions for precision analysis of neutrino event topologies. The ED provided positions of hits in two perpendicular planes: XZ (top view) and YZ (side view). By default, only ED information is displayed in the Demobbed-viewer. After analysis of the ED data the unit of OPERA target (lead-emulsion or ECC brick) that most probably contained the neutrino interaction vertex was extracted from the detector and its emulsion data were analysed as well. 3D view of reconstructed emulsion data can be opened in the ECC display (see description below).
          </p>

          <p>
            <b><u>Brief description of available button actions:</u></b>
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/event-prev.png" class="img-responsive"/>
            </button>
            /
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/event-next.png" class="img-responsive"/>
            </button>
             - go to the previous/next event (if any) in the selected sub-sample. Also the event Id can be specified directly in the nearest edit box.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/event-reload.png" class="img-responsive"/>
            </button>
             - reload the currently displayed event.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/zoom-in.png" class="img-responsive"/>
            </button>
            /
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/zoom-out.png" class="img-responsive"/>
            </button>
             - zoom in/out. Please note that the default (whole detector) views of the ED display can't be zoomed out.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/zoom-brick.png" class="img-responsive"/>
            </button>
             - move the XZ and YZ camera views to the vertex brick. ECC brick that contains the primary neutrino interaction vertex will be shown (an appropriate zooming will be adjusted automatically). The vertex position as well as projections of muon and some long hadron tracks found in the emulsion will be displayed as well.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/zoom-event.png" class="img-responsive"/>
            </button>
             - move the XZ and YZ camera views and adjust zooming in order to display the whole neutrino event region.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/zoom-det.png" class="img-responsive"/>
            </button>
             - show the whole detector region (default option).
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-up.png" class="img-responsive"/>
            </button>
            ,
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-down.png" class="img-responsive"/>
            </button>
            ,
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-left.png" class="img-responsive"/>
            </button>
            , and
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-right.png" class="img-responsive"/>
            </button>
             - move the ED display camera views, correspondingly, up, down, left, and right.
          </p>

          <p>
            The ECC display view can be rotated or moved with help of the left or right mouse buttons, correspondingly.
          </p>

          <!--
          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/open-ECC.png" class="img-responsive"/>
            </button>
            /
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/close-ECC.png" class="img-responsive"/>
            </button>
             - open/close the ECC event display.
          </p>
          -->

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-xz.png" class="img-responsive"/>
            </button>
            ,
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-yz.png" class="img-responsive"/>
            </button>
            , or
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/view-xy.png" class="img-responsive"/>
            </button>
             - show the default XZ, YZ, or XY view of the event in the ECC display.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/stretch-y.png" class="img-responsive"/>
            </button>
            /
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/compress-y.png" class="img-responsive"/>
            </button>
             - stretch/compress the ECC view in the vertical (Y) direction.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/anim-accel.png" class="img-responsive"/>
            </button>
             - start/accelerate animated rotation of the ECC event around the Y (vertical) axis. This button can be clicked several (but not so many!) times.
          </p>

          <p>
            <button type="button" class="btn btn-default btn-xs" onclick="" title="">
              <img src="graphics/anim-decel.png" class="img-responsive"/>
            </button>
             - decelerate animated rotation of the ECC event. In order to stop the rotation this button has to be clicked the same number of times as the "accelerating" button has been clicked before.
          </p>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div> <!-- "div-help" -->

  <!-- ----------------------------------------- -->

  <div id="div-about" role="dialog" class="modal">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times"></i><span class="sr-only">Close</span></button>
          <h4 class="modal-title"><b>About</b></h4>
        </div>

        <div class="modal-body">
          <p>
            <h4>Demobbed-viewer <span id="span-version">v3.0</span></h4>
          </p>
          <p>
            A browser-based event display for visualisation of open data of the <a target="_blank" href="http://operaweb.lngs.infn.it/">OPERA experiment</a>.
          </p>
          <p>
            This application uses <a target="_blank" href="https://d3js.org/">d3.js</a> and <a target="_blank" href="http://threejs.org/">three.js</a> libraries.
            The code is available on the GitHub <a target="_blank" href="https://github.com/cernopendata/demobbed-viewer">repository</a>.
          </p>
          <p>
            <a href="mailto:opendata-support@cern.ch">Questions/comments/problems</a>
          </p>
          <p>
            Contributors: S. Dmitrievsky (<a target="_blank" href="http://www.jinr.ru/main-en/">JINR</a>, Dubna, Russia), G. Tsanaktsidis (<a target="_blank" href="https://home.cern/">CERN</a>, Geneva, Switzerland), M. Vidal (<a target="_blank" href="https://home.cern/">CERN</a>, Geneva, Switzerland).
          </p>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>

      </div>
    </div>
  </div> <!-- "div-about" -->

</html>
